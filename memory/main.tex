\documentclass[a4paper,12pt]{article}

\input{tools/packages.tex}
\input{tools/styles.tex}
\input{tools/acro.tex}

\begin{document}

%%% COVER %%%

\fancypagestyle{alim}{\fancyhf{}\renewcommand{\headrulewidth}{0pt}
\cfoot{\vskip -3cm \includegraphics[height=2.2cm]{img/logos/logo_telecos.png}}
}
\thispagestyle{empty}
\begin{center}
{\sffamily 
\resizebox{0.8\textwidth}{!}{\includegraphics{img/logos/upc_completo+telecos.png}}\\
\vspace{1cm}
{\Huge Analysis and mitigation of writeback cache lock-ups in Linux}\\
\vspace{0.5cm}
{\color{black}\hrule height 1pt}
\vspace{1cm}
{\large{Degree Thesis \\
submitted to the Faculty of the \\
Escola Tècnica d'Enginyeria de Telecomunicació de Barcelona \\
Universitat Politècnica de Catalunya \\
by \\
\vspace{0.5cm}
%{\Huge{Alba Mendez Orero}}
Alba Mendez Orero}}

\vspace{1.5cm}

{In partial fulfillment \\
of the requirements for the degree in \\
\textbf{TELEMATICS ENGINEERING}}

\vspace{1.8cm}

{{Advisor: Juan Jose Costa Prats\\}}
{{Barcelona, June 2020}}

\vspace{2cm}

\thispagestyle{alim}
}

\end{center}


%%% ABSTRACT %%%
\newpage
\section*{Abstract}

Linux caches disk I/O for performance: writes complete immediately from userspace perspective, and are committed to storage later.
But in the presence of heavy writers, this buffering can easily hurt system responsiveness if not handled correctly.

This is well known and has received substantial work, but remains a problem today. In this thesis, we first research the relevant kernel subsystems \& technologies, measure and understand what's happening, then design a PoC to mitigate the adverse effects.

We discover cache flushes to be the issue, because inodes are locked until written to disk. Today's large caches mean inodes from innocent processes can stay locked for long amounts of time. This often \emph{replaces} the intended throttling.

We designed a daemon that detects heavy writers and lowers their I/O priority, allowing inodes from other processes to be written (and unlocked) first. It successfully reduces long pauses and improves responsiveness.

\newpage
\section*{Resum}

\begin{otherlanguage}{catalan}
Linux cacheja les operacions I/O de disc: les escriptures acaben immediatament des de la perspective d'userspace, i més endavant s'escriuen realment al disc. Però en la presència de processos que escriuen sense límit, aquest buffering pot danyar fàcilment el temps de resposta del sistema si no es gestiona de forma justa.

Es tracta d'un problema conegut i que s'ha treballat bastant, però que segueix estant present a dia d'avui. En aquest projecte s'investiguen els subsistemes i tecnologies rellevants del kernel, es mesura i entén el que està passant, i llavors es dissenya un PoC per mitigar els efectes adversos.

Es descobreix que el problema sembla estar en els buidats de la cache, ja que els inodes és bloquegen fins que s'escriuen al disc. Avui dia amb caches tan grans, els inodes de processos innocents poden mantenir-se bloquejats durant un temps llarg mentre esperen ser escrits. Això fins i tot \emph{reemplaça} el throttling normal.

S'ha dissenyat un daemon que detecta processos ofensius i els redueix la prioritat I/O, de forma que quan es buidi la cache, els inodes d'altres processos s'escriguin (i es desbloquegin) primer. Això aconsegueix reduir les llargues pauses i millora la fluidesa del sistema.
\end{otherlanguage}

\newpage
\section*{Resumen}

\begin{otherlanguage}{spanish}
Linux cachea las operaciones I/O de disco: las escrituras acaban inmediatamente desde la perspectiva de userspace, y más adelante se escriben realmente al disco. Pero en la presencia de procesos que escriben sin límite, este buffering puede dañar facilmente la responsividad del sistema si no se gestiona de forma justa.

Se trata de un problema conocido y que se ha trabajado bastante, pero que sigue presente a día de hoy. En este proyecto se investigan los subsistemas y tecnologías relevantes del kernel, se mide y racionaliza el comportamiento observado, y finalmente se diseña un PoC para mitigar los efectos adversos.

Se descubre que el problema parece estar en los vaciados de cache, ya que los inodes son bloqueados hasta que se escriben al disco. Hoy en día con cachés tan grandes, los inodes de procesos inocentes pueden mantenerse mucho tiempo bloqueados mientras esperan ser escritos. Esto aveces \emph{reemplaza} el throttling normal.

Se ha diseñado un daemon que detecta procesos ofensivos y les reduce la prioridad I/O, de forma que cuando se vacie la caché, los inodes del resto de procesos se escriban (y desbloqueen) antes. Esto consigue reducir las largas pausas y mejora la fluidez del sistema.
\end{otherlanguage}


%%% INDEX %%%
\newpage
{\hypersetup{linkcolor=black}
\tableofcontents
}

%%% LISTS %%%
\newpage
{\hypersetup{linkcolor=black}
\listoffigures
\listoflistings
\listoftables
}

\newpage
\input{revision_history}


%%% CONTENT %%%
\newpage
\input{introduction}

\newpage
\input{sota}

%%% METHODOLOGY %%%
\newpage
\input{development}


%%% TESTING %%%
\newpage
\input{results}

%%% BUDGET %%%
\clearpage
\section{Budget}

{Depending on the thesis scope this document should include:}

%%% ENVIRONMENT %%%
%\clearpage
%\section[Environment Impact (Optional)]{{Environment Impact (Optional)}}
%
%{Whether the tasks that have led to the realization of this thesis, as if its results have identifiable environmental
%impact, describe it in this section.}

%%% CONCLUSIONS AND FUTURE %%%
\clearpage
\section{Conclusions}
\label{sec:conclusions}

TODO

\section{Future Work}
\label{sec:futwork}

TODO

%%% BIBLIOGRAPHY %%%
\newpage

\medskip

\bibliographystyle{unsrt}
\bibliography{bibliography.bib}

%%% ANNEX %%%
\clearpage
\newpage
\begin{appendices}

\input{appendix}

\end{appendices}

%%% GLOSSARY %%%
\cleardoublepage
\addcontentsline{toc}{section}{Glossary}
\printacronyms[include=abbrev,name=Glossary]

\end{document}
